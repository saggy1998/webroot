<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Webroot</title>
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link type="text/css" rel="stylesheet" href="localsite/css/base.css" id="/localsite/css/base.css" />
<link type="text/css" rel="stylesheet" href="team/css/common.css" />
<script type="text/javascript" src="localsite/js/localsite.js?showheader=true&showsearch=true"></script>
<script type="text/javascript" src="team/js/common.js"></script>
<script type="text/javascript" src="team/js/setup.js"></script>

<script>
// Create OS detection panel using shared function
autoCreateOSDetectionPanel('#commonSetupDiv');

loadMarkdown("README.md", "readmeDiv", "_parent", 1, function() {
    // https://partnertools.github.io/webroot/
    // Process content after README loads into #readmeDiv

    let currentPath = window.location.href;
    let myRepo = "PartnerTools"; // Default
    
    // Extract GitHub account from URL if available
    // Pattern: https://[account].github.io/webroot/ or similar GitHub Pages patterns
    const githubPagesMatch = currentPath.match(/\/\/([^.]+)\.github\.io/);
    if (githubPagesMatch && githubPagesMatch[1]) {
        myRepo = githubPagesMatch[1];
    } else if (currentPath.includes("localhost") || currentPath.includes("model.earth")) {
        myRepo = "modelearth";
    }
    
    let linkString = "<a href='https://github.com/" + myRepo + "/webroot/' target='github_fork'>github.com/" + myRepo + "/webroot</a>";
    
    // Replace "the webroot repo" with linkString in the #textInPage div
    setTimeout(() => {
        const textInPage = document.getElementById('textInPage');
        if (textInPage) {
            // Preserve field values before innerHTML replacement
            const gitAccountField = document.getElementById("gitAccount");
            const myWebrootForkNameField = document.getElementById("myWebrootForkName");
            const gitAccountValue = gitAccountField ? gitAccountField.value : '';
            const myWebrootForkNameValue = myWebrootForkNameField ? myWebrootForkNameField.value : '';
            
            // Replace the content
            textInPage.innerHTML = textInPage.innerHTML.replace(/the webroot repo/g, linkString);
            
            // Restore field values after replacement
            const newGitAccountField = document.getElementById("gitAccount");
            const newMyWebrootForkNameField = document.getElementById("myWebrootForkName");
            if (newGitAccountField && gitAccountValue) {
                newGitAccountField.value = gitAccountValue;
            }
            if (newMyWebrootForkNameField && myWebrootForkNameValue) {
                newMyWebrootForkNameField.value = myWebrootForkNameValue;
            }
            
            // Fields will be initialized when setupGitAccountFields is called later
        }
    }, 100);
    
    // Setup webroot setup content and Git account fields after content processing
    setTimeout(() => {
        setupWebrootSetup('webrootSetup');
        setupGitAccountFields('textInPage');
        setupTradeFlowRepos('tradeFlowRepos');
        
        // Update fork repos commands after README loads and fields are setup
        setTimeout(() => {
            updateForkReposCommands();
        }, 100);
    }, 200);
    
    // Process webroot path and port adjustments in #readmeDiv after README loads
    //setTimeout(() => {
        const readmeDiv = document.getElementById('readmeDiv');
        if (readmeDiv) {
            let content = readmeDiv.innerHTML;
            
            // Detect current port from window.location
            const currentPort = window.location.port;
            const hasExplicitPort = currentPort !== '';
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            
            // Detect webroot folder from current path
            const currentPathname = window.location.pathname;
            const pathSegments = currentPathname.split('/').filter(segment => segment);
            
            // Check if we're in a webroot container (has a parent folder) and on localhost
            let webrootFolder = '';
            if (pathSegments.length > 0 && isLocalhost) {
                // Only use webroot folder for localhost URLs with explicit ports
                if (hasExplicitPort) {
                    webrootFolder = pathSegments[0];
                }
            }
            
            // Replace localhost:8887 with current port if different and port is explicitly in URL
            if (hasExplicitPort && currentPort !== '8887') {
                content = content.replace(/localhost:8887/g, `localhost:${currentPort}`);
                
                // Add port notice at the top
                const portNotice = `<div style="background-color: #e7f3ff; border: 1px solid #b3d9ff; padding: 10px; margin-bottom: 15px; border-radius: 5px;"><strong>Your current port ${currentPort} has been used to replace 8887 in the display below.</strong></div>`;
                content = portNotice + content;
            }
            
            // If we're in a webroot folder on localhost with explicit port, insert it after "localhost:port/"
            if (webrootFolder) {
                const portPattern = new RegExp(`localhost:${currentPort || '8887'}/`, 'g');
                content = content.replace(portPattern, `localhost:${currentPort || '8887'}/${webrootFolder}/`);
                
                // Populate the #myWebrootForkName field if webroot folder is detected and different from "webroot"
                if (webrootFolder !== "webroot") {
                    setTimeout(() => {
                        const webrootForkNameField = document.getElementById("myWebrootForkName");
                        if (webrootForkNameField && !webrootForkNameField.value) {
                            webrootForkNameField.value = webrootFolder;
                            updateGitAccountFields(); // Update storage and links
                        }
                    }, 100);
                }
            }
            
            readmeDiv.innerHTML = content;
        }
    //}, 200);
});

</script>

</head>

<body>
<div class="content contentpadding">
    <div class="card" id="textInPage">
      <div id="webrootSetup"></div>
    </div>
    <div id="commonSetupDiv"></div>
    <div id="readmeDiv" class="card"></div>
</div>
</body>
</html>